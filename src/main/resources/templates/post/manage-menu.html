<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <!-- Favicon -->
    <link rel="shortcut icon" th:href="@{/images/favicon.ico}" type="image/x-icon"/>
    <!-- Icon - IconMonster -->
    <link rel="stylesheet" href="https://cdn.iconmonstr.com/1.3.0/css/iconmonstr-iconic-font.min.css"/>
    <!-- Mumble UI -->
    <link rel="stylesheet" th:href="@{/uikit/styles/uikit.css}"/>
    <!-- Dev Search UI -->
    <link rel="stylesheet" th:href="@{/styles/app.css}"/>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>메뉴 관리</title>
    <style>
      .field-error {
 border-color: #dc3545;
 color: #dc3545;


    </style>
</head>

<body>
<!-- Header Section -->
<div th:replace="main/nav :: header"></div>

<!-- Main Section -->
<main class="singleProject my-md">
    <div th:each="m : ${menus}">
        <div class="card">
            <h5 class="card-header" th:text="${m.name}">메뉴이름</h5>
            <div class="card-body">
                <h5 class="card-title" th:text="${m.price}">가격</h5>
                <p class="card-text" th:text="${m.getStatus()}">메뉴상태 (품절, 대표)</p>
                <a th:onclick="|stock('${m.id}')|" class="btn btn-primary">품절 처리/복구</a>
                <a th:onclick="|best('${m.id}')|" class="btn btn-primary">대표메뉴 등록/취소</a>
                <a th:href="@{/menus/{id}/edit(id=${m.id})}" class="btn btn-primary">메뉴 수정</a>
                <a th:onclick="|delMenu('${m.id}')|" class="btn btn-primary">메뉴 삭제</a>
            </div>
        </div>
    </div>

</main>
</body>
<script th:inline="javascript">
    function best(mid){
        if(!confirm("대표 상태를 변경하시겠습니까?")){
            return;
        }
        let postUrl = "/menus/" + mid + "/status";

        $.ajax({
            type: "post",
            url : postUrl,
            headers: {'Content-Type': 'application/json'},
            data : JSON.stringify({ data : 'best'}),
            success : function(result){
                alert("대표 메뉴 설정 변경");
                window.location.reload();
            },
            error : function(error){
                alert("잠시 후 다시 시도해주세요.");
            }
        });
    }
        function stock(mid){
        if(!confirm("품절 상태를 변경하시겠습니까?")){
            return;
        }
        let postUrl = "/menus/" + mid + "/status";

        $.ajax({
            type: "post",
            url : postUrl,
            headers: {'Content-Type': 'application/json'},
            data : JSON.stringify({ data : 'stock'}),
            success : function(result){
                alert("품절 상태 변경");
                window.location.reload();
            },
            error : function(error){
                alert("잠시 후 다시 시도해주세요.");
            }
        });
    }
     function delMenu(mid){
        let postUrl = "/menus/" + mid + "/del";
        if(!confirm("해당 메뉴를 삭제하시겠습니까?")){
            return;
        }
        $.ajax({
            type : 'post',
            url : postUrl,
            success : function(result){
                alert("삭제 되었습니다.");
                window.location.reload();
            },
            error : function(error){
                alert("예기치 못한 에러, 잠시 후 다시 시도해주세요");
            }
        });
    }

</script>
</html>